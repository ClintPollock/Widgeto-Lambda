name: Test Britive OIDC Login

on:
  workflow_dispatch:

permissions:
  id-token: write
  contents: read

jobs:
  test-login:
    runs-on: ubuntu-latest

    steps:
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'

    - name: Install pybritive
      run: pip install pybritive --quiet
    - name: Create legacy config for Britive CLI
      run: |
        mkdir -p ~/.britive
        cat <<EOF > ~/.britive/pybritive.config
        [tenant-se-learn]
        name=se-learn
        output_format=json
        EOF
  
        echo "üìÑ Contents of pybritive.config:"
        cat ~/.britive/pybritive.config


    - name: Federated Britive Checkout
      run: |
        echo "üîê Federated checkout using GitHub OIDC + env var"
        pybritive --version
        ls -la ~/.britive/
        pybritive checkout "AWS Standalone/Widgeto Prod/Widgeto-App-S3-Prod-Access" \
          --federation-provider github \
          --mode json
      env:
        PYBRITIVE_TENANT: se-learn
