name: Test Britive OIDC Login

on:
  workflow_dispatch:

permissions:
  id-token: write
  contents: read

jobs:
  test-login:
    runs-on: ubuntu-latest

    env:
      PYBRITIVE_HOME_DIR: ${{ github.workspace }}
      PYBRITIVE_ENCRYPTED_CREDENTIAL_PASSPHRASE: "ci-oidc-access-passphrase"

    steps:
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      - name: Install pybritive
        run: pip install pybritive --quiet

      - name: Federated Britive Checkout and Set AWS Credentials
        run: |
          pybritive checkout "AWS Standalone/Widgeto Prod/Widgeto-App-S3-Prod-Access" \
            --tenant se-learn \
            --federation-provider github-britive
