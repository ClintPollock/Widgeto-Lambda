name: Test Britive OIDC Login

on:
  workflow_dispatch:

permissions:
  id-token: write
  contents: read

jobs:
  test-login:
    runs-on: ubuntu-latest

    steps:
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'

    - name: Install pybritive
      run: pip install pybritive --quiet

    - name: Configure Britive Tenant
      run: |
        pybritive configure tenant --tenant se-learn --no-prompt
        
    - name: Attempt Federated OIDC Login via GitHub
      run: |
        echo "üîê Attempting federated login to Britive using GitHub OIDC..."
        if pybritive checkout "widgeto-ci-deploy" --federation-provider github --mode json; then
          echo "‚úÖ Federated login successful."
        else
          echo "‚ùå Federated login failed."
          exit 1
        fi
